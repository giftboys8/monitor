# 数据初始化指南

## 概述

本项目提供了统一的数据初始化脚本 `init_all_data.py`，整合了原有的多个初始化脚本功能，提供更好的用户体验。

## 脚本功能

### 1. 统一初始化脚本 (`init_all_data.py`)

**主要特性：**
- 整合了监控项初始化和完整系统数据初始化
- 支持多种初始化模式
- 提供交互式和命令行两种使用方式
- 自动检测重复数据，避免冲突
- 完善的错误处理和回滚机制

**支持的初始化模式：**

1. **仅监控项模式** (`monitor-only`)
   - 只初始化12个基础监控指标
   - 适用于已有系统，只需要添加监控项的场景
   - 自动跳过已存在的监控项

2. **完整系统模式** (`full`)
   - 初始化所有系统数据（应用、服务器、实例、监控项、告警规则、告警事件、指标数据）
   - 保留现有数据，只添加新数据
   - 适用于在现有数据基础上扩展

3. **清空重建模式** (`full-clean`)
   - 清空所有现有数据后重新初始化
   - 适用于全新部署或重置系统
   - 需要用户确认操作

## 使用方法

### 交互式使用

```bash
python3 init_all_data.py
```

脚本会提示选择初始化模式：
```
请选择初始化模式:
1. 仅初始化监控项 (monitor-only)
2. 初始化完整系统数据 (full)
3. 清空并重新初始化完整系统数据 (full-clean)

请输入选择 (1/2/3):
```

### 命令行使用

```bash
# 仅初始化监控项
python3 init_all_data.py monitor-only

# 初始化完整系统数据
python3 init_all_data.py full

# 清空并重新初始化
python3 init_all_data.py full-clean
```

## 初始化内容详情

### 基础监控项 (12个)

| 监控项 | 代码 | 类型 | 单位 | 警告阈值 | 严重阈值 |
|--------|------|------|------|----------|----------|
| CPU使用率 | cpu_usage | CPU | % | 70 | 85 |
| 内存使用率 | memory_usage | MEMORY | % | 75 | 90 |
| 磁盘使用率 | disk_usage | DISK | % | 80 | 95 |
| 网络入流量 | network_in | NETWORK | MB/s | 100 | 200 |
| 网络出流量 | network_out | NETWORK | MB/s | 100 | 200 |
| 请求响应时间 | response_time | REQUEST | ms | 500 | 1000 |
| 请求成功率 | success_rate | REQUEST | % | 95 | 90 |
| 并发连接数 | concurrent_connections | CONNECTION | 个 | 1000 | 2000 |
| JVM堆内存使用率 | jvm_heap_usage | JVM | % | 70 | 85 |
| GC频率 | gc_frequency | JVM | 次/分钟 | 10 | 20 |
| 数据库连接数 | db_connections | DATABASE | 个 | 80 | 100 |
| 队列长度 | queue_length | QUEUE | 个 | 100 | 500 |

### 完整系统数据

- **应用数据**: 5个示例应用（用户管理、订单处理、商品管理、支付网关、数据分析）
- **服务器数据**: 5台服务器（Web服务器、数据库服务器、缓存服务器等）
- **实例数据**: 10个应用实例（每个应用2个实例）
- **告警规则**: 20个告警规则（前10个监控项，每个2个级别）
- **告警事件**: 15个测试告警事件
- **指标数据**: 最近24小时的监控数据（每10分钟一个数据点）

## 数据库配置

脚本使用以下数据库配置：

```python
DB_CONFIG = {
    'host': 'localhost',
    'port': 3308,
    'user': 'root',
    'password': '123456',
    'database': 'app_monitor_db',
    'charset': 'utf8mb4'
}
```

如需修改，请编辑 `init_all_data.py` 文件中的 `DB_CONFIG` 部分。

## 注意事项

1. **数据库连接**: 确保MySQL服务正在运行，且配置正确
2. **权限要求**: 确保数据库用户有足够的权限进行增删改查操作
3. **数据备份**: 在使用 `full-clean` 模式前，建议备份重要数据
4. **网络环境**: 确保能够连接到数据库服务器

## 故障排除

### 常见错误

1. **数据库连接失败**
   ```
   数据库连接失败: (2003, "Can't connect to MySQL server...")
   ```
   - 检查MySQL服务是否启动
   - 检查端口号和主机地址是否正确
   - 检查用户名和密码是否正确

2. **权限不足**
   ```
   (1045, "Access denied for user...")
   ```
   - 检查数据库用户权限
   - 确保用户有对应数据库的操作权限

3. **表不存在**
   ```
   (1146, "Table 'app_monitor_db.xxx' doesn't exist")
   ```
   - 先运行数据库初始化脚本 `docs/db/init.sql`
   - 确保所有表都已正确创建

## 旧脚本说明

以下脚本已被 `init_all_data.py` 整合，建议使用新的统一脚本：

- `init_monitor_items.py` - 监控项初始化（已整合）
- `init_data.py` - 完整数据初始化（已整合）
- `check_alert_data.py` - 数据检查工具（仍可独立使用）
- `test_monitor_items.py` - 监控项测试工具（仍可独立使用）

## 使用建议

1. **首次部署**: 使用 `full-clean` 模式进行完整初始化
2. **添加监控项**: 使用 `monitor-only` 模式
3. **扩展测试数据**: 使用 `full` 模式
4. **生产环境**: 建议先在测试环境验证，再在生产环境使用